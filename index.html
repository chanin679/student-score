<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>‡∏£‡∏∞‡∏ö‡∏ö‡πÉ‡∏´‡πâ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Prompt:wght@300;400;600&display=swap');

        body {
            font-family: 'Prompt', sans-serif;
            background: #f0f4f8;
            color: #333;
            margin: 0;
            padding: 20px;
            text-align: center;
        }

        .container {
            max-width: 400px;
            background: #fff;
            padding: 20px;
            border-radius: 12px;
            box-shadow: 0px 4px 10px rgba(0, 0, 0, 0.1);
            margin: auto;
        }

        .logo {
            width: 80px;
            height: auto;
            margin-bottom: 5px;
        }

        h2 {
            color: #2d89ef;
            font-weight: 600;
            margin-top: 0;
            margin-bottom: 5px;
        }

        .subtitle {
            font-size: 16px;
            color: black;
            font-weight: 500;
        }

        label {
            display: block;
            font-size: 16px;
            margin: 10px 0 5px;
            font-weight: 500;
        }

        select, button {
            width: 100%;
            padding: 10px;
            font-size: 16px;
            margin-bottom: 10px;
            border-radius: 8px;
            border: 1px solid #ccc;
            background: #fff;
        }

        button {
            background: #2d89ef;
            color: white;
            font-weight: bold;
            cursor: pointer;
            border: none;
            transition: 0.3s;
        }

        button:hover {
            background: #1c6cd5;
        }

        #historyDisplay {
            background: #eef2f7;
            padding: 10px;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 500;
            margin-top: 10px;
        }
    </style>
    <script>
        const API_URL = "https://script.google.com/macros/s/AKfycbwr5W7yUlq4P5RuaWOF48JxODT1WA30BCNOfAZJKCfnkAxL4EyAbK84OuRXopOqqyYwSg/exec";
        let studentDataCache = null;

        async function fetchStudentData() {
            if (studentDataCache) return studentDataCache;
            let response = await fetch(API_URL + "?action=getStudents");
            studentDataCache = await response.json();
            return studentDataCache;
        }

        async function loadStudents() {
            let students = await fetchStudentData();
            let roomSelect = document.getElementById("roomSelect");
            roomSelect.innerHTML = `<option value="">-- ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏´‡πâ‡∏≠‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô --</option>`;
            Object.keys(students).forEach(room => {
                roomSelect.innerHTML += `<option value="${room}">${room}</option>`;
            });

            roomSelect.addEventListener("change", function() {
                let studentSelect = document.getElementById("studentSelect");
                studentSelect.innerHTML = `<option value="">-- ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ä‡∏∑‡πà‡∏≠‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô --</option>`;
                let selectedRoom = this.value;
                if (students[selectedRoom]) {
                    students[selectedRoom].forEach(student => {
                        studentSelect.innerHTML += `<option value="${student.name}" data-history="${student.history || '‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•'}">${student.name} (‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô: ${student.score})</option>`;
                    });
                }
            });

            document.getElementById("studentSelect").addEventListener("change", function() {
                let selectedOption = this.selectedOptions[0];
                let historyText = selectedOption.getAttribute("data-history") || "‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•";
                document.getElementById("historyDisplay").innerText = `‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏û‡∏§‡∏ï‡∏¥‡∏Å‡∏£‡∏£‡∏°: ${historyText}`;
            });
        }

        async function updateScore() {
            let room = document.getElementById("roomSelect").value;
            let name = document.getElementById("studentSelect").value;
            let scoreChange = Number(document.getElementById("behaviorSelect").value);
            let behaviorText = document.getElementById("behaviorSelect").selectedOptions[0].text;

            if (!room || !name || !scoreChange) {
                alert("‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏´‡πâ‡∏Ñ‡∏£‡∏ö‡∏ñ‡πâ‡∏ß‡∏ô");
                return;
            }

            let response = await fetch(API_URL + `?action=updateScore&room=${room}&name=${name}&scoreChange=${scoreChange}&behavior=${encodeURIComponent(behaviorText)}`);
            let result = await response.text();

            if (result === "Success") {
                alert("‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡πÅ‡∏•‡∏∞‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏û‡∏§‡∏ï‡∏¥‡∏Å‡∏£‡∏£‡∏°‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢!");
                studentDataCache = null;
                location.reload(); // ‡∏£‡∏µ‡πÄ‡∏ü‡∏£‡∏ä‡∏´‡∏ô‡πâ‡∏≤‡πÄ‡∏ß‡πá‡∏ö
            } else {
                alert("‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î: " + result);
            }
        }

        window.onload = loadStudents;
    </script>
</head>
<body>
    <div class="container">
        <img src="https://img2.pic.in.th/pic/92100569_0_20190530-104518.png" alt="‡πÇ‡∏•‡πÇ‡∏Å‡πâ‡πÇ‡∏£‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô" class="logo">
        <h2>‡πÇ‡∏£‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏´‡∏≤‡∏î‡∏™‡∏≥‡∏£‡∏≤‡∏ç‡∏ß‡∏¥‡∏ó‡∏¢‡∏≤‡∏Ñ‡∏°</h2>
        <div class="subtitle">üìö ‡∏£‡∏∞‡∏ö‡∏ö‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏û‡∏§‡∏ï‡∏¥‡∏Å‡∏£‡∏£‡∏°‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô</div>
        <div class="subtitle">BY ‡∏Ñ‡∏£‡∏π‡∏ä‡∏ô‡∏¥‡∏ô‡∏ó‡∏£‡πå ‡πÄ‡∏ö‡πâ‡∏≤‡∏ó‡∏≠‡∏á&nbsp&nbspbeta1.0</div>
        
        <label for="roomSelect">üè´ ‡∏´‡πâ‡∏≠‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô:</label>
        <select id="roomSelect"></select>

        <label for="studentSelect">üë©‚Äçüéì ‡∏ä‡∏∑‡πà‡∏≠‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô:</label>
        <select id="studentSelect"></select>

        <label for="behaviorSelect">üìå ‡∏û‡∏§‡∏ï‡∏¥‡∏Å‡∏£‡∏£‡∏°:</label>
        <select id="behaviorSelect">
            <option value="0">--&nbsp‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏û‡∏§‡∏ï‡∏¥‡∏Å‡∏£‡∏£‡∏°&nbsp--</option>
            <option value="10">‡∏ä‡πà‡∏ß‡∏¢‡∏á‡∏≤‡∏ô‡∏Ñ‡∏£‡∏π (+10)</option>
            <option value="-10">‡∏°‡∏≤‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏™‡∏≤‡∏¢ (-10)</option>
            <option value="5">‡∏ó‡∏≥‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏∞‡∏≠‡∏≤‡∏î‡∏´‡πâ‡∏≠‡∏á (+5)</option>
            <option value="-5">‡πÑ‡∏°‡πà‡∏™‡πà‡∏á‡∏Å‡∏≤‡∏£‡∏ö‡πâ‡∏≤‡∏ô (-5)</option>
            <option value="+5">‡πÄ‡∏Å‡πá‡∏ö‡∏Ç‡∏¢‡∏∞ (+5)</option>
        </select>

        <button onclick="updateScore()">‚úÖ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô</button>

        <div id="historyDisplay">‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏û‡∏§‡∏ï‡∏¥‡∏Å‡∏£‡∏£‡∏°: -</div>
    </div>
</body>
</html>
